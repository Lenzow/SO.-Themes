{% doc %}
  @prompt
    ection that looks like a stack of luxury photo cards. In the center there is one main card, and behind it on both sides 2â€“3 cards are slightly smaller, shifted and a bit rotated, like layered printed photos. Each card has a 4:3 image, a white frame, soft shadow, light rounded corners, and a white strip under the image for an optional caption. If the caption field is empty, the strip stays clean with no placeholder text. The carousel should autoplay with a slow, smooth transition where the next card gently moves into the center and the current one slides to the side, using soft easing, not aggressive motion. Users can also change slides with arrows and swipe both on mobile and desktop. On desktop show the side cards, on mobile only show the main card with swipe left or right. Overall style should feel like a high end fashion brand: warm neutral background, subtle depth, calm animation, and elegant typography.
    size should dapt with image size, lease update the section code with these requirements:
    
    Background and padding
    
    Use the section settings for background color and padding.
    
    bg_color should control the section background.
    
    padding_desktop and padding_mobile should control top and bottom padding with a responsive CSS block, not hard coded values.
    
    Remove any fixed padding or background colors from inline styles.
    
    Size and layout
    
    The main image should not fill the entire viewport.
    
    Wrap the slider in a centered container with something like max-width: 1100px; margin: 0 auto;.
    
    Remove any height: 100vh, large fixed heights, or width: 100vw on the section and slider wrappers.
    
    Images should scale responsively using width: 100% and height: auto, with object-fit: cover if needed.
    
    Section behavior
    
    The section must shrink and grow based on its content so it no longer overlaps or hides the section below it.
    
    On mobile the slider should stay full width, but still respect padding_mobile.
    
    Keep the current slider functionality, just refactor the CSS and inline styles so the size, background color, and padding are fully controlled by the theme settings above
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-photo-carousel-{{ ai_gen_id }} {
    background-color: {{ block.settings.bg_color }};
    padding: {{ block.settings.padding_desktop }}px 0;
    overflow: hidden;
    position: relative;
  }

  @media screen and (max-width: 749px) {
    .ai-photo-carousel-{{ ai_gen_id }} {
      padding: {{ block.settings.padding_mobile }}px 0;
    }
  }

  .ai-photo-carousel-container-{{ ai_gen_id }} {
    position: relative;
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 40px;
  }

  @media screen and (max-width: 749px) {
    .ai-photo-carousel-container-{{ ai_gen_id }} {
      padding: 0 20px;
    }
  }

  .ai-photo-carousel-stage-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    perspective: 1500px;
    padding: 60px 0;
  }

  @media screen and (max-width: 749px) {
    .ai-photo-carousel-stage-{{ ai_gen_id }} {
      padding: 40px 0;
    }
  }

  .ai-photo-carousel-track-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }

  .ai-photo-card-{{ ai_gen_id }} {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 600px;
    background: {{ block.settings.card_background }};
    border-radius: {{ block.settings.card_border_radius }}px;
    box-shadow: {{ block.settings.shadow_x }}px {{ block.settings.shadow_y }}px {{ block.settings.shadow_blur }}px rgba(0, 0, 0, {{ block.settings.shadow_opacity | divided_by: 100.0 }});
    padding: {{ block.settings.card_padding }}px;
    transition: all {{ block.settings.transition_speed | divided_by: 1000.0 }}s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    pointer-events: none;
    transform-style: preserve-3d;
  }

  .ai-photo-card-{{ ai_gen_id }}.active {
    position: relative;
    opacity: 1;
    z-index: 10;
    transform: translateX(0) scale(1) rotateY(0deg);
    pointer-events: auto;
    left: auto;
  }

  .ai-photo-card-{{ ai_gen_id }}.left-1 {
    opacity: 0.9;
    z-index: 9;
    transform: translateX(calc(-50% - 280px)) scale(0.85) rotateY(8deg);
  }

  .ai-photo-card-{{ ai_gen_id }}.left-2 {
    opacity: 0.7;
    z-index: 8;
    transform: translateX(calc(-50% - 480px)) scale(0.7) rotateY(12deg);
  }

  .ai-photo-card-{{ ai_gen_id }}.left-3 {
    opacity: 0.5;
    z-index: 7;
    transform: translateX(calc(-50% - 640px)) scale(0.6) rotateY(15deg);
  }

  .ai-photo-card-{{ ai_gen_id }}.right-1 {
    opacity: 0.9;
    z-index: 9;
    transform: translateX(calc(-50% + 280px)) scale(0.85) rotateY(-8deg);
  }

  .ai-photo-card-{{ ai_gen_id }}.right-2 {
    opacity: 0.7;
    z-index: 8;
    transform: translateX(calc(-50% + 480px)) scale(0.7) rotateY(-12deg);
  }

  .ai-photo-card-{{ ai_gen_id }}.right-3 {
    opacity: 0.5;
    z-index: 7;
    transform: translateX(calc(-50% + 640px)) scale(0.6) rotateY(-15deg);
  }

  @media screen and (max-width: 749px) {
    .ai-photo-card-{{ ai_gen_id }}.left-1,
    .ai-photo-card-{{ ai_gen_id }}.left-2,
    .ai-photo-card-{{ ai_gen_id }}.left-3,
    .ai-photo-card-{{ ai_gen_id }}.right-1,
    .ai-photo-card-{{ ai_gen_id }}.right-2,
    .ai-photo-card-{{ ai_gen_id }}.right-3 {
      opacity: 0;
      pointer-events: none;
    }
  }

  .ai-photo-card-image-wrapper-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    aspect-ratio: 4 / 3;
    overflow: hidden;
    border-radius: {{ block.settings.image_border_radius }}px;
    background-color: #f5f5f0;
  }

  .ai-photo-card-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .ai-photo-card-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f5f5f0;
  }

  .ai-photo-card-placeholder-{{ ai_gen_id }} svg {
    width: 60%;
    height: 60%;
    opacity: 0.3;
  }

  .ai-photo-card-caption-{{ ai_gen_id }} {
    background: {{ block.settings.card_background }};
    padding: {{ block.settings.caption_padding }}px 0 0;
    min-height: {{ block.settings.caption_min_height }}px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-photo-card-caption-text-{{ ai_gen_id }} {
    color: {{ block.settings.caption_color }};
    font-size: {{ block.settings.caption_font_size }}px;
    text-align: center;
    font-style: {{ block.settings.caption_font_style }};
    letter-spacing: 0.5px;
  }

  .ai-photo-carousel-nav-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 20;
    background: {{ block.settings.arrow_background }};
    border: none;
    width: {{ block.settings.arrow_size }}px;
    height: {{ block.settings.arrow_size }}px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .ai-photo-carousel-nav-{{ ai_gen_id }}:hover {
    background: {{ block.settings.arrow_hover_background }};
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .ai-photo-carousel-nav-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
    stroke: {{ block.settings.arrow_color }};
  }

  .ai-photo-carousel-nav-{{ ai_gen_id }}:hover svg {
    stroke: {{ block.settings.arrow_hover_color }};
  }

  .ai-photo-carousel-nav-prev-{{ ai_gen_id }} {
    left: 20px;
  }

  .ai-photo-carousel-nav-next-{{ ai_gen_id }} {
    right: 20px;
  }

  @media screen and (max-width: 749px) {
    .ai-photo-carousel-nav-{{ ai_gen_id }} {
      width: {{ block.settings.arrow_size_mobile }}px;
      height: {{ block.settings.arrow_size_mobile }}px;
    }

    .ai-photo-carousel-nav-{{ ai_gen_id }} svg {
      width: 16px;
      height: 16px;
    }

    .ai-photo-carousel-nav-prev-{{ ai_gen_id }} {
      left: 10px;
    }

    .ai-photo-carousel-nav-next-{{ ai_gen_id }} {
      right: 10px;
    }
  }

  .ai-photo-carousel-dots-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 40px;
  }

  .ai-photo-carousel-dot-{{ ai_gen_id }} {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: {{ block.settings.dot_color }};
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
  }

  .ai-photo-carousel-dot-{{ ai_gen_id }}.active {
    background: {{ block.settings.dot_active_color }};
    transform: scale(1.3);
  }

  .ai-photo-carousel-dot-{{ ai_gen_id }}:hover {
    background: {{ block.settings.dot_active_color }};
  }
{% endstyle %}

<luxury-photo-carousel-{{ ai_gen_id }}
  class="ai-photo-carousel-{{ ai_gen_id }}"
  data-autoplay="{{ block.settings.autoplay }}"
  data-autoplay-speed="{{ block.settings.autoplay_speed }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-photo-carousel-container-{{ ai_gen_id }}">
    <div class="ai-photo-carousel-stage-{{ ai_gen_id }}">
      <div class="ai-photo-carousel-track-{{ ai_gen_id }}">
        {% for i in (1..6) %}
          {% liquid
            assign image_key = 'image_' | append: i
            assign caption_key = 'caption_' | append: i
            assign image = block.settings[image_key]
            assign caption = block.settings[caption_key]
          %}

          {% if image != blank or caption != blank %}
            <div class="ai-photo-card-{{ ai_gen_id }}" data-index="{{ forloop.index0 }}">
              <div class="ai-photo-card-image-wrapper-{{ ai_gen_id }}">
                {% if image != blank %}
                  <img
                    src="{{ image | image_url: width: 800 }}"
                    alt="{{ image.alt | escape }}"
                    class="ai-photo-card-image-{{ ai_gen_id }}"
                    loading="lazy"
                    width="800"
                    height="600"
                  >
                {% else %}
                  <div class="ai-photo-card-placeholder-{{ ai_gen_id }}">
                    {{ 'image' | placeholder_svg_tag }}
                  </div>
                {% endif %}
              </div>
              <div class="ai-photo-card-caption-{{ ai_gen_id }}">
                {% if caption != blank %}
                  <p class="ai-photo-card-caption-text-{{ ai_gen_id }}">{{ caption }}</p>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <button
        class="ai-photo-carousel-nav-{{ ai_gen_id }} ai-photo-carousel-nav-prev-{{ ai_gen_id }}"
        aria-label="Previous slide"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>

      <button
        class="ai-photo-carousel-nav-{{ ai_gen_id }} ai-photo-carousel-nav-next-{{ ai_gen_id }}"
        aria-label="Next slide"
      >
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </button>
    </div>

    <div class="ai-photo-carousel-dots-{{ ai_gen_id }}"></div>
  </div>
</luxury-photo-carousel-{{ ai_gen_id }}>

<script>
  (function() {
    class LuxuryPhotoCarousel{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentIndex = 0;
        this.autoplayInterval = null;
        this.touchStartX = 0;
        this.touchEndX = 0;
        this.isDragging = false;
      }

      connectedCallback() {
        this.cards = Array.from(this.querySelectorAll('.ai-photo-card-{{ ai_gen_id }}'));
        this.prevButton = this.querySelector('.ai-photo-carousel-nav-prev-{{ ai_gen_id }}');
        this.nextButton = this.querySelector('.ai-photo-carousel-nav-next-{{ ai_gen_id }}');
        this.dotsContainer = this.querySelector('.ai-photo-carousel-dots-{{ ai_gen_id }}');
        this.stage = this.querySelector('.ai-photo-carousel-stage-{{ ai_gen_id }}');

        if (this.cards.length === 0) return;

        this.setupDots();
        this.setupEventListeners();
        this.updateCarousel();

        if (this.dataset.autoplay === 'true') {
          this.startAutoplay();
        }
      }

      disconnectedCallback() {
        this.stopAutoplay();
      }

      setupDots() {
        this.cards.forEach((card, index) => {
          const dot = document.createElement('button');
          dot.classList.add('ai-photo-carousel-dot-{{ ai_gen_id }}');
          dot.setAttribute('aria-label', `Go to slide ${index + 1}`);
          dot.addEventListener('click', () => this.goToSlide(index));
          this.dotsContainer.appendChild(dot);
        });
        this.dots = Array.from(this.dotsContainer.querySelectorAll('.ai-photo-carousel-dot-{{ ai_gen_id }}'));
      }

      setupEventListeners() {
        this.prevButton.addEventListener('click', () => this.prev());
        this.nextButton.addEventListener('click', () => this.next());

        this.stage.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: true });
        this.stage.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: true });
        this.stage.addEventListener('touchend', () => this.handleTouchEnd());

        this.stage.addEventListener('mousedown', (e) => this.handleMouseDown(e));
        this.stage.addEventListener('mousemove', (e) => this.handleMouseMove(e));
        this.stage.addEventListener('mouseup', () => this.handleMouseUp());
        this.stage.addEventListener('mouseleave', () => this.handleMouseUp());
      }

      handleTouchStart(e) {
        this.touchStartX = e.changedTouches[0].screenX;
        this.stopAutoplay();
      }

      handleTouchMove(e) {
        this.touchEndX = e.changedTouches[0].screenX;
      }

      handleTouchEnd() {
        if (this.touchStartX - this.touchEndX > 50) {
          this.next();
        }

        if (this.touchEndX - this.touchStartX > 50) {
          this.prev();
        }

        if (this.dataset.autoplay === 'true') {
          this.startAutoplay();
        }
      }

      handleMouseDown(e) {
        this.isDragging = true;
        this.touchStartX = e.screenX;
        this.stopAutoplay();
      }

      handleMouseMove(e) {
        if (!this.isDragging) return;
        this.touchEndX = e.screenX;
      }

      handleMouseUp() {
        if (!this.isDragging) return;
        this.isDragging = false;

        if (this.touchStartX - this.touchEndX > 50) {
          this.next();
        }

        if (this.touchEndX - this.touchStartX > 50) {
          this.prev();
        }

        if (this.dataset.autoplay === 'true') {
          this.startAutoplay();
        }
      }

      prev() {
        this.currentIndex = (this.currentIndex - 1 + this.cards.length) % this.cards.length;
        this.updateCarousel();
      }

      next() {
        this.currentIndex = (this.currentIndex + 1) % this.cards.length;
        this.updateCarousel();
      }

      goToSlide(index) {
        this.currentIndex = index;
        this.updateCarousel();
        this.stopAutoplay();
        if (this.dataset.autoplay === 'true') {
          this.startAutoplay();
        }
      }

      updateCarousel() {
        this.cards.forEach((card, index) => {
          card.classList.remove('active', 'left-1', 'left-2', 'left-3', 'right-1', 'right-2', 'right-3');

          const position = (index - this.currentIndex + this.cards.length) % this.cards.length;

          if (position === 0) {
            card.classList.add('active');
          } else if (position === 1) {
            card.classList.add('right-1');
          } else if (position === 2) {
            card.classList.add('right-2');
          } else if (position === 3) {
            card.classList.add('right-3');
          } else if (position === this.cards.length - 1) {
            card.classList.add('left-1');
          } else if (position === this.cards.length - 2) {
            card.classList.add('left-2');
          } else if (position === this.cards.length - 3) {
            card.classList.add('left-3');
          }
        });

        this.dots.forEach((dot, index) => {
          if (index === this.currentIndex) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      }

      startAutoplay() {
        this.stopAutoplay();
        const speed = parseInt(this.dataset.autoplaySpeed) || 5000;
        this.autoplayInterval = setInterval(() => {
          this.next();
        }, speed);
      }

      stopAutoplay() {
        if (this.autoplayInterval) {
          clearInterval(this.autoplayInterval);
          this.autoplayInterval = null;
        }
      }
    }

    customElements.define('luxury-photo-carousel-{{ ai_gen_id }}', LuxuryPhotoCarousel{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Luxury photo carousel",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background",
      "default": "#f5f3f0"
    },
    {
      "type": "range",
      "id": "padding_desktop",
      "min": 40,
      "max": 120,
      "step": 10,
      "unit": "px",
      "label": "Padding desktop",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_mobile",
      "min": 30,
      "max": 80,
      "step": 5,
      "unit": "px",
      "label": "Padding mobile",
      "default": 60
    },
    {
      "type": "header",
      "content": "Card style"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_padding",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Card border radius",
      "default": 4
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "Image border radius",
      "default": 2
    },
    {
      "type": "range",
      "id": "shadow_x",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Shadow horizontal",
      "default": 0
    },
    {
      "type": "range",
      "id": "shadow_y",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Shadow vertical",
      "default": 10
    },
    {
      "type": "range",
      "id": "shadow_blur",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "label": "Shadow blur",
      "default": 30
    },
    {
      "type": "range",
      "id": "shadow_opacity",
      "min": 5,
      "max": 30,
      "step": 1,
      "unit": "%",
      "label": "Shadow opacity",
      "default": 15
    },
    {
      "type": "header",
      "content": "Caption"
    },
    {
      "type": "range",
      "id": "caption_padding",
      "min": 10,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Top padding",
      "default": 20
    },
    {
      "type": "range",
      "id": "caption_min_height",
      "min": 30,
      "max": 80,
      "step": 5,
      "unit": "px",
      "label": "Minimum height",
      "default": 50
    },
    {
      "type": "color",
      "id": "caption_color",
      "label": "Text color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "caption_font_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Font size",
      "default": 14
    },
    {
      "type": "select",
      "id": "caption_font_style",
      "label": "Font style",
      "options": [
        {
          "value": "normal",
          "label": "Normal"
        },
        {
          "value": "italic",
          "label": "Italic"
        }
      ],
      "default": "italic"
    },
    {
      "type": "header",
      "content": "Navigation arrows"
    },
    {
      "type": "color",
      "id": "arrow_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "arrow_hover_background",
      "label": "Hover background",
      "default": "#f5f5f5"
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "Icon color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "arrow_hover_color",
      "label": "Hover icon color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "arrow_size",
      "min": 40,
      "max": 70,
      "step": 5,
      "unit": "px",
      "label": "Size desktop",
      "default": 50
    },
    {
      "type": "range",
      "id": "arrow_size_mobile",
      "min": 35,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Size mobile",
      "default": 40
    },
    {
      "type": "header",
      "content": "Dots"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot color",
      "default": "#d4d4d4"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Active dot color",
      "default": "#333333"
    },
    {
      "type": "header",
      "content": "Autoplay"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Enable autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3000,
      "max": 9000,
      "step": 500,
      "unit": "ms",
      "label": "Autoplay speed",
      "default": 5000
    },
    {
      "type": "range",
      "id": "transition_speed",
      "min": 500,
      "max": 2000,
      "step": 100,
      "unit": "ms",
      "label": "Transition speed",
      "default": 800
    },
    {
      "type": "header",
      "content": "Photo 1"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_1",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Photo 2"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_2",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Photo 3"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_3",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Photo 4"
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_4",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Photo 5"
    },
    {
      "type": "image_picker",
      "id": "image_5",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_5",
      "label": "Caption"
    },
    {
      "type": "header",
      "content": "Photo 6"
    },
    {
      "type": "image_picker",
      "id": "image_6",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "caption_6",
      "label": "Caption"
    }
  ],
  "presets": [
    {
      "name": "Luxury photo carousel"
    }
  ]
}
{% endschema %}
